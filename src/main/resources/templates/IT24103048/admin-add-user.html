<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/admin-layout :: adminLayout(~{::title}, ~{::content})}">
<head>
    <title>Add New User - VaxConnect Sri Lanka</title>
</head>

<body>
<div th:fragment="content">
    <!-- Page Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Add New User</h1>
            <p class="text-gray-600">Create a new system user account with appropriate role assignment</p>
        </div>
        <a th:href="@{/admin/users}" class="inline-flex items-center px-6 py-3 text-gray-700 bg-gray-100 border border-gray-300 font-semibold rounded-xl hover:bg-gray-200 transition-all duration-300">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Users
        </a>
    </div>

    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
        <div class="flex items-center">
            <svg class="w-5 h-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            <span class="text-green-800 font-medium" th:text="${successMessage}">Success message</span>
        </div>
    </div>

    <div th:if="${errorMessage}" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
        <div class="flex items-center">
            <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            <span class="text-red-800 font-medium" th:text="${errorMessage}">Error message</span>
        </div>
    </div>

    <!-- Form Card -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
        <form th:action="@{/admin/users/save}" th:object="${user}" method="post" class="space-y-6">
            <!-- Personal Information Section -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Personal Information
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Full Name -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                            Full Name <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            th:field="*{name}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                            placeholder="Enter full name"
                            required
                        >
                        <div th:if="${#fields.hasErrors('name')}" class="mt-1 text-sm text-red-600">
                            <span th:errors="*{name}">Name error</span>
                        </div>
                    </div>

                    <!-- NIC -->
                    <div>
                        <label for="nic" class="block text-sm font-medium text-gray-700 mb-2">
                            National ID (NIC) <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="nic" 
                            th:field="*{nic}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                            placeholder="Enter NIC number"
                            required
                        >
                        <div th:if="${#fields.hasErrors('nic')}" class="mt-1 text-sm text-red-600">
                            <span th:errors="*{nic}">NIC error</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Information Section -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    Account Information
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Email -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            th:field="*{email}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                            placeholder="Enter email address"
                            required
                        >
                        <div th:if="${#fields.hasErrors('email')}" class="mt-1 text-sm text-red-600">
                            <span th:errors="*{email}">Email error</span>
                        </div>
                    </div>

                    <!-- Temporary Password -->
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                            Temporary Password <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="password" 
                            id="password" 
                            th:field="*{password}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                            placeholder="Enter temporary password"
                            required
                        >
                        <p class="mt-1 text-sm text-gray-500">User will be required to change this password on first login</p>
                        <div th:if="${#fields.hasErrors('password')}" class="mt-1 text-sm text-red-600">
                            <span th:errors="*{password}">Password error</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Role Assignment Section -->
            <div class="pb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <svg class="w-5 h-5 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                    Role Assignment
                </h3>
                
                <div>
                    <label for="role" class="block text-sm font-medium text-gray-700 mb-2">
                        Assign Role <span class="text-red-500">*</span>
                    </label>
                    <select 
                        id="role" 
                        th:field="*{role}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        required
                    >
                        <option value="">-- Select a Role --</option>
                        <option value="ROLE_USER">User (Patient)</option>
                        <option value="ROLE_NURSE">Nurse</option>
                        <option value="ROLE_PHI">PHI (Public Health Inspector)</option>
                        <option value="ROLE_INVENTORY_MANAGER">Inventory Manager</option>
                        <option value="ROLE_MINISTRY_OF_HEALTH">Ministry of Health</option>
                        <option value="ROLE_ADMIN">System Administrator</option>
                    </select>
                    <div th:if="${#fields.hasErrors('role')}" class="mt-1 text-sm text-red-600">
                        <span th:errors="*{role}">Role error</span>
                    </div>
                </div>

                <!-- Role Information -->
                <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-start">
                        <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h4 class="text-sm font-medium text-blue-800">Role Permissions</h4>
                            <ul class="text-sm text-blue-700 mt-1 space-y-1">
                                <li>• <strong>User:</strong> Book appointments, view vaccination records</li>
                                <li>• <strong>Nurse:</strong> Manage vaccination records, view patient data</li>
                                <li>• <strong>PHI:</strong> Monitor public health, generate reports</li>
                                <li>• <strong>Inventory Manager:</strong> Manage vaccine stock and inventory</li>
                                <li>• <strong>Ministry of Health:</strong> Access system-wide analytics</li>
                                <li>• <strong>Admin:</strong> Full system access and user management</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="flex items-start">
                    <svg class="w-5 h-5 text-gray-600 mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <h4 class="text-sm font-medium text-gray-800">Additional Information</h4>
                        <p class="text-sm text-gray-600 mt-1">
                            Personal details like address, phone number, and medical history can be added by the user after their first login. 
                            The user will be required to change their temporary password on first login for security purposes.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
                <a th:href="@{/admin/users}" class="px-6 py-3 text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-3 text-white font-semibold rounded-lg transition-all duration-200" style="background-color: #1E51DB;" onmouseover="this.style.backgroundColor='#1a47c4'" onmouseout="this.style.backgroundColor='#1E51DB'">
                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Create User
                </button>
            </div>
        </form>
    </div>
</div>
</body>
</html>